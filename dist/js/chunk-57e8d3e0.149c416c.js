(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57e8d3e0"],{c304:function(e,t,a){"use strict";var s=a("de60"),i=a.n(s);i.a},de60:function(e,t,a){},e018:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"face-detect"}},[a("div",[a("strong",[e._v(e._s("login"===this.father?"识别人脸":"绑定人脸"))])]),a("video",{ref:"video",attrs:{id:"v"}}),a("router-link",{staticStyle:{color:"white"},attrs:{to:"/main"}},[a("div",{staticClass:"bt"},[a("button",[e._v("返回首页")])])]),a("div",[a("span",{ref:"ts",attrs:{id:"ts"}},[e._v(e._s(e.detectTips))])]),a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"canvas",attrs:{id:"canvas",width:"200",height:"200"}})],1)},i=[],r=(a("99af"),a("b0c0"),a("b64b"),a("ac1f"),a("1276"),{data:function(){return{father:this.$route.query.father,detectTips:""}},created:function(){this.openVideo()},methods:{openVideo:function(){var e=this,t=navigator.mediaDevices.getUserMedia({audio:!1,video:{width:{ideal:230},height:{ideal:230}}});t.then((function(t){var a=e.$refs.video;a.srcObject=t,a.onloadedmetadata=function(e){a.play()},e.dengdai("正在识别...")})).catch((function(e){console.log("访问用户媒体设备失败".concat(error.name,", ").concat(error.message))}))},dengdai:function(e){var t=this;setTimeout((function(){t.detectTips=e,t.faceDetect()}),2e3)},faceDetect:function(){var e=this.$refs.canvas,t=this.$refs.video,a=e.getContext("2d");a.drawImage(t,0,0,230,230);var s=this.convertImageToBase64(e).split(",")[1];switch(this.father){case"login":this.Login(s);break;case"register":this.RegFace(s);break;case"update-face":this.UpdateFace(s);break}},RegFace:function(e){var t=this,a={user_id:this.$store.state.user.user_id,group_id:this.$store.state.user.user_type,access_token:this.$store.state.access_token,image_type:"BASE64",image:e};this.$api.postRegFace(a).then((function(e){switch(e.error_code){case 0:t.detectTips="人脸绑定成功！",t.$message.loading("人脸绑定成功！",2,(function(){t.$router.push({path:"/main"})}));break;case 2213105:t.detectTips="该账号已经绑定过人脸啦~请返回注册";break;case 222202:t.dengdai("没有检测到人脸，正在重新检测。。");break;case 222207:t.dengdai("没有匹配到相应用户，正在重新检测。。");break;default:t.dengdai("没有检测到人脸，正在重新检测。。");break}})).catch((function(e){t.detectTips="识别失败！请检查网络！",t.$message.error("失败！请检查网络")}))},Login:function(e){var t=this,a={user_id:this.$store.state.user.user_id,group_id_list:this.$store.state.user.user_type,access_token:this.$store.state.access_token,image_type:"BASE64",image:e};this.$api.Login(a).then((function(e){switch(e.error_code){case 0:var a=e.result.user_list[0].score;a>=95?(t.detectTips="登录成功",t.$store.commit("updateUser",{user_id:e.result.user_list[0].user_id}),t.saveTolocalStorage({log_token:e["log_token"]}),t.$message.loading("登录成功",2,(function(){switch(e.result.user_list[0].group_id){case"USER":t.$router.push({path:"/student-layout"});break;case"ADMIN":t.$router.push({path:"/layout"});break}}))):t.dengdai("没有匹配到相应用户，正在重新检测。。");break;case 222018:t.$message.loading("没有用户信息,正在返回上一级。。",2,(function(){t.$router.push({path:"/main/login"})}));break;default:t.dengdai("没有匹配到相应用户，正在重新检测。。");break}})).catch((function(e){return console.log(e)}))},UpdateFace:function(e){var t=this,a={user_id:this.$store.state.user.user_id,group_id:this.$store.state.user.user_type,access_token:this.$store.state.access_token,image_type:"BASE64",image:e};this.$api.ChangeFace(a).then((function(e){switch(e.error_code){case 0:t.detectTips="人脸修改成功！",t.$message.loading("人脸修改成功！",2,(function(){t.$router.push({path:"/main"})}));break;case 222001:t.dengdai("没有检测到人脸，正在重新检测。。");break;case 222018:t.$message.loading("没有用户信息,正在返回上一级。。",2,(function(){t.$router.push({path:"/main/update-face"})}));break;default:t.$message.error("未知错误！");break}})).catch((function(e){return console.log(e)}))},convertImageToBase64:function(e){var t=e.toDataURL("image/jpeg",.92);return t},saveTolocalStorage:function(e){for(var t=0,a=Object.keys(e);t<a.length;t++){var s=a[t];localStorage.setItem(s,e[s])}return e}}}),o=r,n=(a("c304"),a("2877")),c=Object(n["a"])(o,s,i,!1,null,"6b67f2f7",null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-57e8d3e0.149c416c.js.map