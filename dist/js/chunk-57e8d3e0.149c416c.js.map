{"version":3,"sources":["webpack:///./src/views/Main/components/FaceDetect.vue?5c10","webpack:///./src/views/Main/components/FaceDetect.vue?deee","webpack:///src/views/Main/components/FaceDetect.vue","webpack:///./src/views/Main/components/FaceDetect.vue?8fdc","webpack:///./src/views/Main/components/FaceDetect.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","_v","_s","father","ref","staticStyle","staticClass","detectTips","directives","name","rawName","value","expression","staticRenderFns","data","$route","query","created","openVideo","methods","audio","video","width","height","Media","then","videoObj","srcObject","mediaStream","onloadedmetadata","play","console","log","dengdai","setTimeout","faceDetect","context","drawImage","base64_img","convertImageToBase64","canvas","split","Login","RegFace","UpdateFace","user_id","$store","state","user","group_id","user_type","access_token","image_type","image","$api","postRegFace","group_id_list","ChangeFace","img","toDataURL","saveTolocalStorage","localStorage","setItem","key","obj","component"],"mappings":"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","file":"js/chunk-57e8d3e0.149c416c.js","sourcesContent":["import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/vuetify-loader/lib/loader.js??ref--17-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceDetect.vue?vue&type=style&index=0&id=6b67f2f7&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/vuetify-loader/lib/loader.js??ref--17-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceDetect.vue?vue&type=style&index=0&id=6b67f2f7&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"face-detect\"}},[_c('div',[_c('strong',[_vm._v(_vm._s(this.father==='login'? '识别人脸':'绑定人脸'))])]),_c('video',{ref:\"video\",attrs:{\"id\":\"v\"}}),_c('router-link',{staticStyle:{\"color\":\"white\"},attrs:{\"to\":\"/main\"}},[_c('div',{staticClass:\"bt\"},[_c('button',[_vm._v(\"返回首页\")])])]),_c('div',[_c('span',{ref:\"ts\",attrs:{\"id\":\"ts\"}},[_vm._v(_vm._s(_vm.detectTips))])]),_c('canvas',{directives:[{name:\"show\",rawName:\"v-show\",value:(false),expression:\"false\"}],ref:\"canvas\",attrs:{\"id\":\"canvas\",\"width\":\"200\",\"height\":\"200\"}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div id=\"face-detect\">\r\n    <div>\r\n      <strong>{{this.father==='login'? '识别人脸':'绑定人脸'}}</strong>\r\n    </div>\r\n    <video id=\"v\" ref=\"video\">\r\n    </video>\r\n    <router-link to=\"/main\" style=\"color: white\">\r\n      <div class=\"bt\">\r\n        <button>返回首页</button>\r\n      </div>\r\n    </router-link>\r\n    <div>\r\n      <span id=\"ts\" ref=\"ts\">{{ detectTips }}</span>\r\n    </div>\r\n    <canvas id=\"canvas\" ref=\"canvas\" width=\"200\" height=\"200\" v-show=\"false\"></canvas>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n  data() {\r\n    return {\r\n      father: this.$route.query.father,\r\n      detectTips: \"\",\r\n    };\r\n  },\r\n  created(){\r\n    this.openVideo(); //打开人脸绑定页的摄像头\r\n  },\r\n  methods: {\r\n    //打开摄像头\r\n    openVideo() {\r\n      let Media = navigator.mediaDevices.getUserMedia({\r\n        audio: false,\r\n        video: {\r\n          width: { ideal: 230 },\r\n          height: { ideal: 230 }\r\n        }\r\n      });\r\n      Media.then(mediaStream => {\r\n        //成功时调用的callback函数\r\n        let videoObj = this.$refs.video;\r\n        videoObj.srcObject = mediaStream; //设置video的srcObject\r\n        videoObj.onloadedmetadata = e => {\r\n          videoObj.play();\r\n        };\r\n        this.dengdai(\"正在识别...\");\r\n      }).catch(err => {\r\n        //失败时调用的callback函数\r\n        console.log(`访问用户媒体设备失败${error.name}, ${error.message}`);\r\n      });\r\n    },\r\n    dengdai(msg) {\r\n      setTimeout(() => {\r\n        this.detectTips = msg;\r\n        this.faceDetect();\r\n      }, 2000);\r\n    },\r\n    faceDetect() {\r\n      let canvas = this.$refs.canvas;\r\n      let videoObj = this.$refs.video;\r\n      let context = canvas.getContext(\"2d\");\r\n      context.drawImage(videoObj, 0, 0, 230, 230);\r\n      var base64_img = this.convertImageToBase64(canvas).split(\",\")[1];\r\n      switch (this.father) {\r\n        case \"login\":\r\n          this.Login(base64_img);\r\n          break;\r\n        case \"register\":\r\n          this.RegFace(base64_img);\r\n          break;\r\n        case \"update-face\":\r\n          this.UpdateFace(base64_img);\r\n          break;\r\n      }\r\n    },\r\n    RegFace(base64_img) {\r\n      let user={\r\n        user_id: this.$store.state.user.user_id,\r\n        group_id: this.$store.state.user.user_type,\r\n        access_token: this.$store.state.access_token,\r\n        image_type: \"BASE64\",\r\n        image: base64_img\r\n      };\r\n      this.$api.postRegFace(user).then(res => {\r\n          switch (res.error_code) {\r\n            case 0:\r\n              this.detectTips = \"人脸绑定成功！\";\r\n              this.$message.loading('人脸绑定成功！',2,()=>{\r\n                this.$router.push({path:'/main'})\r\n              })\r\n              break;\r\n            case 2213105:\r\n              this.detectTips = \"该账号已经绑定过人脸啦~请返回注册\";\r\n              break;\r\n            case 222202:\r\n              this.dengdai(\"没有检测到人脸，正在重新检测。。\");\r\n              break;\r\n            case 222207:\r\n              this.dengdai(\"没有匹配到相应用户，正在重新检测。。\");\r\n              break;\r\n            default:\r\n              this.dengdai(\"没有检测到人脸，正在重新检测。。\");\r\n              break;\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.detectTips = \"识别失败！请检查网络！\";\r\n          this.$message.error(\"失败！请检查网络\");\r\n        });\r\n    },\r\n    Login(base64_img) {\r\n      let user={\r\n        user_id: this.$store.state.user.user_id,\r\n        group_id_list: this.$store.state.user.user_type,\r\n        access_token: this.$store.state.access_token,\r\n        image_type: \"BASE64\",\r\n        image: base64_img\r\n      };\r\n      this.$api.Login(user).then(res => {\r\n          switch (res.error_code) {\r\n            case 0:\r\n              const score = res.result.user_list[0].score; //匹配分数\r\n              if (score >= 95) {\r\n                this.detectTips = \"登录成功\";\r\n                this.$store.commit(\"updateUser\", {\r\n                  user_id: res.result.user_list[0].user_id\r\n                }); //user_id 存进vuex\r\n                this.saveTolocalStorage({\r\n                  log_token: res[\"log_token\"]\r\n                });//log_token存入localStorage\r\n                this.$message.loading(\"登录成功\", 2,()=>{\r\n                  // 判断用户类型，若为USER跳转到/student-layout（考生页面）,若为ADMIN跳转到/Layout（管理员页面）\r\n                  switch (res.result.user_list[0].group_id) {\r\n                    case \"USER\":\r\n                      //跳转到学生主页\r\n                      this.$router.push({path: \"/student-layout\"});\r\n                      break;\r\n                    case \"ADMIN\":\r\n                      // 跳转到管理员主页\r\n                      this.$router.push({path: \"/layout\"});\r\n                      break;\r\n                  }\r\n                });\r\n              } else {\r\n                this.dengdai(\"没有匹配到相应用户，正在重新检测。。\");\r\n              }\r\n              break;\r\n            case 222018:\r\n              this.$message.loading('没有用户信息,正在返回上一级。。',2,()=>{\r\n                this.$router.push({path:'/main/login'})\r\n              })\r\n              break;\r\n            default:\r\n              this.dengdai(\"没有匹配到相应用户，正在重新检测。。\");\r\n              break;\r\n          }\r\n        })\r\n        .catch(error => console.log(error));\r\n    },\r\n    UpdateFace(base64_img) {\r\n      let user={\r\n        user_id: this.$store.state.user.user_id,\r\n        group_id: this.$store.state.user.user_type,\r\n        access_token: this.$store.state.access_token,\r\n        image_type: \"BASE64\",\r\n        image: base64_img\r\n      };\r\n      this.$api.ChangeFace(user).then(res => {\r\n          switch (res.error_code) {\r\n            case 0:\r\n              this.detectTips = \"人脸修改成功！\";\r\n              this.$message.loading('人脸修改成功！',2,()=>{\r\n                this.$router.push({path:'/main'})\r\n              })\r\n              break;\r\n            case 222001:\r\n              this.dengdai(\"没有检测到人脸，正在重新检测。。\");\r\n              break;\r\n            case 222018:\r\n              this.$message.loading('没有用户信息,正在返回上一级。。',2,()=>{\r\n                this.$router.push({path:'/main/update-face'})\r\n              })\r\n              break;\r\n            default:\r\n              this.$message.error('未知错误！')\r\n              break;\r\n          }\r\n        })\r\n        .catch(error => console.log(error));\r\n    },\r\n    convertImageToBase64(canvas) {\r\n      var img = canvas.toDataURL(\"image/jpeg\", 0.92);\r\n      return img;\r\n    },\r\n    saveTolocalStorage(obj) {\r\n      for (let key of Object.keys(obj)) {\r\n        localStorage.setItem(key, obj[key]);\r\n      }\r\n      return obj;\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n#face-detect {\r\n  color: rgb(255, 195, 0);\r\n  #v {\r\n    border-radius: 50%;\r\n  }\r\n\r\n  #canvas {\r\n    z-index: -1;\r\n    position: absolute;\r\n  }\r\n\r\n  #ts {\r\n    float: right;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--17-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceDetect.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--17-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceDetect.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./FaceDetect.vue?vue&type=template&id=6b67f2f7&scoped=true&\"\nimport script from \"./FaceDetect.vue?vue&type=script&lang=js&\"\nexport * from \"./FaceDetect.vue?vue&type=script&lang=js&\"\nimport style0 from \"./FaceDetect.vue?vue&type=style&index=0&id=6b67f2f7&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6b67f2f7\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}